# 回测历史界面优化说明

## 修改概述

根据用户需求，对回测历史界面进行了以下优化：
1. 隐藏"交易次数"列
2. 新增"最近一次交易时间"列

## 具体修改

### 1. 表格列修改

**修改前**：
- 显示"交易次数"列，显示策略在回测期间的总交易次数

**修改后**：
- 隐藏"交易次数"列
- 新增"最近一次交易时间"列，显示最后一次交易的时间

### 2. 代码实现

#### 表格列定义修改
```typescript
// 修改前：交易次数列
{
  title: '交易次数',
  key: 'trade_count',
  width: 80,
  align: 'center',
  render: (_, record) => {
    const tradeCount = record.trade_records?.length || 0;
    return (
      <Tag color={tradeCount > 0 ? 'blue' : 'default'}>
        {tradeCount}
      </Tag>
    );
  },
},

// 修改后：最近一次交易时间列
{
  title: '最近一次交易时间',
  key: 'last_trade_time',
  width: 120,
  align: 'center',
  render: (_, record) => {
    const tradeRecords = record.trade_records || [];
    if (tradeRecords.length === 0) {
      return <Text style={{ color: '#999' }}>-</Text>;
    }
    
    // 获取最后一次交易的时间
    const lastTrade = tradeRecords[tradeRecords.length - 1];
    const lastTradeDate = lastTrade?.date;
    
    if (!lastTradeDate) {
      return <Text style={{ color: '#999' }}>-</Text>;
    }
    
    return (
      <div style={{ fontSize: '12px', lineHeight: '1.4' }}>
        <div>{dayjs(lastTradeDate).format('MM-DD')}</div>
        <div style={{ color: '#999' }}>{dayjs(lastTradeDate).format('HH:mm')}</div>
      </div>
    );
  },
},
```

#### 详情页面统计信息修改
```typescript
// 修改前：显示交易次数
<Statistic
  title={<span>交易次数 <Tooltip title="策略在回测期间的总交易次数"><InfoCircleOutlined style={{ fontSize: 14, color: '#aaa' }} /></Tooltip></span>}
  value={selectedBacktest.trade_records?.length || 0}
/>

// 修改后：显示最近一次交易时间
<Statistic
  title={<span>最近一次交易时间 <Tooltip title="最后一次交易的时间"><InfoCircleOutlined style={{ fontSize: 14, color: '#aaa' }} /></Tooltip></span>}
  value={(() => {
    const tradeRecords = selectedBacktest.trade_records || [];
    if (tradeRecords.length === 0) {
      return '-';
    }
    const lastTrade = tradeRecords[tradeRecords.length - 1];
    const lastTradeDate = lastTrade?.date;
    if (!lastTradeDate) {
      return '-';
    }
    return dayjs(lastTradeDate).format('MM-DD HH:mm');
  })()}
/>
```

## 功能特点

### 1. 最近一次交易时间显示
- **数据源**：从 `trade_records` 数组中获取最后一次交易记录
- **显示格式**：表格中显示为三行（日期+方向+价格），详情页面显示为单行（日期 (方向 @ 价格)）
- **交易方向**：显示最后一次交易的方向（买入/卖出），买入显示红色，卖出显示绿色
- **交易价格**：显示最后一次交易的价格，格式为 $XX.XX
- **空值处理**：当没有交易记录时显示 "-"

### 2. 时间格式
- **表格显示**：MM-DD 格式的日期，交易方向，交易价格
- **详情显示**：MM-DD 格式的日期 + (方向 @ 价格)

### 3. 响应式设计
- 列宽设置为 160px，确保时间信息、交易方向和价格完整显示
- 使用小字体和紧凑布局，保持界面整洁
- 交易方向使用不同颜色区分（买入红色，卖出绿色）
- 价格信息使用较小字体和灰色显示

### 4. 界面优化
- **隐藏初始资金列**：移除了"初始资金"列，简化界面显示
- **增强交易信息**：在"最近一次交易时间"列中添加了交易价格信息

## 技术实现

### 1. 数据获取逻辑
```typescript
// 获取交易记录数组
const tradeRecords = record.trade_records || [];

// 检查是否有交易记录
if (tradeRecords.length === 0) {
  return <Text style={{ color: '#999' }}>-</Text>;
}

// 获取最后一次交易记录
const lastTrade = tradeRecords[tradeRecords.length - 1];
const lastTradeDate = lastTrade?.date;
```

### 2. 时间格式化
```typescript
// 使用 dayjs 进行时间格式化
dayjs(lastTradeDate).format('MM-DD')  // 日期格式
dayjs(lastTradeDate).format('HH:mm')  // 时间格式
dayjs(lastTradeDate).format('MM-DD HH:mm')  // 完整格式
```

### 3. 样式设计
- 使用 `Text` 组件显示时间信息
- 使用灰色显示空值状态
- 使用小字体和紧凑布局

## 用户体验改进

1. **信息更有用**：最近一次交易时间比交易次数更能反映策略的活跃度
2. **时间感知**：用户可以快速了解策略的最后交易时间
3. **界面简洁**：隐藏了相对不重要的交易次数信息
4. **数据完整性**：保持了所有必要的交易相关信息

## 兼容性

- 完全向后兼容现有的回测数据
- 自动处理没有交易记录的情况
- 保持原有的界面布局和交互逻辑

这次优化使回测历史界面更加实用，用户可以更直观地了解策略的交易活跃度和最后交易时间。
